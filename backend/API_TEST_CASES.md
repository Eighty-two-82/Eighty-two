# API æµ‹è¯•ç”¨ä¾‹æ–‡æ¡£

## è®¿é—® Swagger UI
å¯åŠ¨åç«¯æœåŠ¡åï¼Œè®¿é—®ï¼š
```
http://localhost:8080/swagger-ui.html
```

---

## 1. æ—¥å¸¸æ’ç­ç®¡ç†åŠŸèƒ½æµ‹è¯•

### 1.1 æ‰¹é‡åˆ›å»ºæ’ç­
**æ¥å£**: `POST /api/schedules/batch-create`

**è¯·æ±‚å¤´**:
```json
X-Organization-Id: org-001
X-User-Id: manager-001
```

**è¯·æ±‚ä½“**:
```json
{
  "scheduleDate": "2025-01-20",
  "morningShiftWorkerIds": ["W001", "W002"],
  "eveningShiftWorkerIds": ["W003", "W004"],
  "scheduleNotes": "æ­£å¸¸æ’ç­"
}
```

**é¢„æœŸç»“æœ**: è¿”å›åˆ›å»ºçš„4ä¸ªæ’ç­è®°å½•

---

### 1.2 æ‰¹é‡æ›´æ–°æ’ç­çŠ¶æ€
**æ¥å£**: `PUT /api/schedules/batch-update-status`

**è¯·æ±‚ä½“**:
```json
{
  "scheduleIds": ["schedule_id_1", "schedule_id_2"],
  "status": "confirmed"
}
```

**é¢„æœŸç»“æœ**: è¿”å›æ›´æ–°åçš„æ’ç­åˆ—è¡¨

---

### 1.3 å¤åˆ¶æ’ç­
**æ¥å£**: `POST /api/schedules/copy`

**è¯·æ±‚å¤´**:
```json
X-Organization-Id: org-001
X-User-Id: manager-001
```

**è¯·æ±‚ä½“**:
```json
{
  "sourceDate": "2025-01-20",
  "targetDate": "2025-01-21",
  "organizationId": "org-001",
  "managerId": "manager-001"
}
```

**é¢„æœŸç»“æœ**: å°†2025-01-20çš„æ’ç­å¤åˆ¶åˆ°2025-01-21

---

### 1.4 è·å–å‘¨æ’ç­
**æ¥å£**: `GET /api/schedules/weekly?startDate=2025-01-20&organizationId=org-001`

**é¢„æœŸç»“æœ**: è¿”å›ä»2025-01-20å¼€å§‹çš„ä¸€å‘¨æ’ç­

---

### 1.5 éªŒè¯æ’ç­å†²çª
**æ¥å£**: `GET /api/schedules/validate?workerId=W001&date=2025-01-20&shiftType=morning`

**é¢„æœŸç»“æœ**: è¿”å›trueï¼ˆæ— å†²çªï¼‰æˆ–falseï¼ˆæœ‰å†²çªï¼‰

---

### 1.6 åˆ é™¤æŒ‡å®šæ—¥æœŸçš„æ‰€æœ‰æ’ç­
**æ¥å£**: `DELETE /api/schedules/date/2025-01-20?organizationId=org-001`

**é¢„æœŸç»“æœ**: è¿”å›åˆ é™¤çš„æ’ç­æ•°é‡

---

## 2. å‘˜å·¥ç…§ç‰‡ä¸Šä¼ åŠŸèƒ½æµ‹è¯•

### 2.1 ç®€åŒ–ä¸Šä¼ ç…§ç‰‡æ¥å£
**æ¥å£**: `POST /api/workers/{workerId}/photo`

**è·¯å¾„å‚æ•°**: `workerId = W001`

**è¯·æ±‚ä½“**:
```json
{
  "photoUrl": "https://example.com/photos/worker1.jpg"
}
```

**é¢„æœŸç»“æœ**: è¿”å›æ›´æ–°åçš„å‘˜å·¥ä¿¡æ¯ï¼ŒåŒ…å«ç…§ç‰‡URL

---

### 2.2 æ‰¹é‡ä¸Šä¼ ç…§ç‰‡
**æ¥å£**: `POST /api/workers/batch-upload-photos`

**è¯·æ±‚ä½“**:
```json
{
  "W001": "https://example.com/photos/worker1.jpg",
  "W002": "https://example.com/photos/worker2.jpg",
  "W003": "https://example.com/photos/worker3.jpg"
}
```

**é¢„æœŸç»“æœ**: è¿”å›3ä¸ªæ›´æ–°åçš„å‘˜å·¥ä¿¡æ¯

---

### 2.3 åˆ é™¤å‘˜å·¥ç…§ç‰‡
**æ¥å£**: `DELETE /api/workers/W001/photo`

**é¢„æœŸç»“æœ**: è¿”å›æ›´æ–°åçš„å‘˜å·¥ä¿¡æ¯ï¼ŒphotoUrlä¸ºnull

---

### 2.4 è·å–æ²¡æœ‰ç…§ç‰‡çš„å‘˜å·¥
**æ¥å£**: `GET /api/workers/organization/org-001/without-photos`

**é¢„æœŸç»“æœ**: è¿”å›æ²¡æœ‰ä¸Šä¼ ç…§ç‰‡çš„å‘˜å·¥åˆ—è¡¨

---

## 3. é€šçŸ¥åŠŸèƒ½æµ‹è¯•

### 3.1 è·å–æˆ‘çš„é€šçŸ¥
**æ¥å£**: `GET /api/notifications/my`

**è¯·æ±‚å¤´**:
```json
X-User-Id: user-001
```

**é¢„æœŸç»“æœ**: è¿”å›å½“å‰ç”¨æˆ·çš„æ‰€æœ‰é€šçŸ¥

---

### 3.2 è·å–æœªè¯»é€šçŸ¥
**æ¥å£**: `GET /api/notifications/unread`

**è¯·æ±‚å¤´**:
```json
X-User-Id: user-001
```

**é¢„æœŸç»“æœ**: è¿”å›æœªè¯»é€šçŸ¥åˆ—è¡¨

---

### 3.3 è·å–æœªè¯»é€šçŸ¥æ•°é‡
**æ¥å£**: `GET /api/notifications/unread/count`

**è¯·æ±‚å¤´**:
```json
X-User-Id: user-001
```

**é¢„æœŸç»“æœ**: è¿”å›æœªè¯»é€šçŸ¥æ•°é‡

---

### 3.4 æ ‡è®°é€šçŸ¥ä¸ºå·²è¯»
**æ¥å£**: `PUT /api/notifications/{notificationId}/read`

**é¢„æœŸç»“æœ**: è¿”å›æ›´æ–°åçš„é€šçŸ¥ï¼ŒisRead=true

---

### 3.5 æ ‡è®°æ‰€æœ‰é€šçŸ¥ä¸ºå·²è¯»
**æ¥å£**: `PUT /api/notifications/read-all`

**è¯·æ±‚å¤´**:
```json
X-User-Id: user-001
```

**é¢„æœŸç»“æœ**: è¿”å›æ ‡è®°ä¸ºå·²è¯»çš„é€šçŸ¥æ•°é‡

---

### 3.6 åˆ›å»ºä»»åŠ¡åˆ†é…é€šçŸ¥
**æ¥å£**: `POST /api/notifications/task-assigned`

**è¯·æ±‚ä½“**:
```json
{
  "workerId": "W001",
  "taskId": "task-001",
  "taskTitle": "ååŠ©ç—…äººç”¨é¤",
  "assignedBy": "manager-001"
}
```

**é¢„æœŸç»“æœ**: åˆ›å»ºä¸€ä¸ªä»»åŠ¡åˆ†é…é€šçŸ¥

---

### 3.7 åˆ›å»ºä»»åŠ¡å®Œæˆé€šçŸ¥
**æ¥å£**: `POST /api/notifications/task-completed`

**è¯·æ±‚ä½“**:
```json
{
  "managerId": "manager-001",
  "taskId": "task-001",
  "taskTitle": "ååŠ©ç—…äººç”¨é¤",
  "completedBy": "W001"
}
```

**é¢„æœŸç»“æœ**: åˆ›å»ºä¸€ä¸ªä»»åŠ¡å®Œæˆé€šçŸ¥

---

### 3.8 åˆ›å»ºæ’ç­æ›´æ–°é€šçŸ¥
**æ¥å£**: `POST /api/notifications/schedule-updated`

**è¯·æ±‚ä½“**:
```json
{
  "workerId": "W001",
  "scheduleDate": "2025-01-20",
  "shiftType": "morning",
  "updatedBy": "manager-001"
}
```

**é¢„æœŸç»“æœ**: åˆ›å»ºä¸€ä¸ªæ’ç­æ›´æ–°é€šçŸ¥

---

### 3.9 åˆ é™¤é€šçŸ¥
**æ¥å£**: `DELETE /api/notifications/{notificationId}`

**é¢„æœŸç»“æœ**: é€šçŸ¥è¢«åˆ é™¤

---

### 3.10 æŒ‰ç±»åˆ«è·å–é€šçŸ¥
**æ¥å£**: `GET /api/notifications/category/task`

**è¯·æ±‚å¤´**:
```json
X-User-Id: user-001
```

**é¢„æœŸç»“æœ**: è¿”å›ä»»åŠ¡ç±»åˆ«çš„é€šçŸ¥

---

## 4. é€šä¿¡åŠŸèƒ½æµ‹è¯•

### 4.1 å‘é€æ¶ˆæ¯
**æ¥å£**: `POST /api/messages`

**è¯·æ±‚å¤´**:
```json
X-User-Id: user-001
X-Organization-Id: org-001
```

**è¯·æ±‚ä½“**:
```json
{
  "subject": "å…³äºç—…äººP1çš„æŠ¤ç†è®¡åˆ’",
  "content": "æ‚¨å¥½ï¼Œæˆ‘æƒ³è®¨è®ºä¸€ä¸‹P1çš„æŠ¤ç†è®¡åˆ’è°ƒæ•´ã€‚",
  "toUserId": "user-002",
  "toUserName": "å¼ åŒ»ç”Ÿ",
  "fromUserName": "ææŠ¤å£«",
  "category": "general"
}
```

**é¢„æœŸç»“æœ**: æ¶ˆæ¯å‘é€æˆåŠŸï¼ŒåŒæ—¶åˆ›å»ºé€šçŸ¥ç»™æ¥æ”¶è€…

---

### 4.2 è·å–æ”¶ä»¶ç®±
**æ¥å£**: `GET /api/messages/inbox`

**è¯·æ±‚å¤´**:
```json
X-User-Id: user-001
```

**é¢„æœŸç»“æœ**: è¿”å›ç”¨æˆ·æ¥æ”¶çš„æ‰€æœ‰æ¶ˆæ¯

---

### 4.3 è·å–å‘ä»¶ç®±
**æ¥å£**: `GET /api/messages/sent`

**è¯·æ±‚å¤´**:
```json
X-User-Id: user-001
```

**é¢„æœŸç»“æœ**: è¿”å›ç”¨æˆ·å‘é€çš„æ‰€æœ‰æ¶ˆæ¯

---

### 4.4 è·å–æœªè¯»æ¶ˆæ¯
**æ¥å£**: `GET /api/messages/unread`

**è¯·æ±‚å¤´**:
```json
X-User-Id: user-001
```

**é¢„æœŸç»“æœ**: è¿”å›æœªè¯»æ¶ˆæ¯åˆ—è¡¨

---

### 4.5 è·å–æœªè¯»æ¶ˆæ¯æ•°é‡
**æ¥å£**: `GET /api/messages/unread/count`

**è¯·æ±‚å¤´**:
```json
X-User-Id: user-001
```

**é¢„æœŸç»“æœ**: è¿”å›æœªè¯»æ¶ˆæ¯æ•°é‡

---

### 4.6 å›å¤æ¶ˆæ¯
**æ¥å£**: `POST /api/messages/{messageId}/reply`

**è¯·æ±‚å¤´**:
```json
X-User-Id: user-002
X-Organization-Id: org-001
```

**è¯·æ±‚ä½“**:
```json
{
  "content": "å¥½çš„ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ˜å¤©ä¸Šåˆ10ç‚¹è®¨è®ºè¿™ä¸ªé—®é¢˜ã€‚",
  "fromUserName": "å¼ åŒ»ç”Ÿ"
}
```

**é¢„æœŸç»“æœ**: å›å¤å‘é€æˆåŠŸï¼Œsubjectè‡ªåŠ¨æ·»åŠ "Re:"å‰ç¼€

---

### 4.7 æ ‡è®°æ¶ˆæ¯ä¸ºå·²è¯»
**æ¥å£**: `PUT /api/messages/{messageId}/read`

**é¢„æœŸç»“æœ**: æ¶ˆæ¯æ ‡è®°ä¸ºå·²è¯»ï¼Œstatusæ›´æ–°ä¸º"read"

---

### 4.8 è·å–æ¶ˆæ¯è¯¦æƒ…
**æ¥å£**: `GET /api/messages/{messageId}`

**é¢„æœŸç»“æœ**: è¿”å›å®Œæ•´çš„æ¶ˆæ¯ä¿¡æ¯

---

### 4.9 å½’æ¡£æ¶ˆæ¯
**æ¥å£**: `PUT /api/messages/{messageId}/archive`

**é¢„æœŸç»“æœ**: æ¶ˆæ¯çŠ¶æ€æ›´æ–°ä¸º"archived"

---

### 4.10 åˆ é™¤æ¶ˆæ¯
**æ¥å£**: `DELETE /api/messages/{messageId}`

**é¢„æœŸç»“æœ**: æ¶ˆæ¯æ ‡è®°ä¸ºåˆ é™¤ï¼ˆè½¯åˆ é™¤ï¼‰

---

### 4.11 æ°¸ä¹…åˆ é™¤æ¶ˆæ¯
**æ¥å£**: `DELETE /api/messages/{messageId}/permanent`

**é¢„æœŸç»“æœ**: æ¶ˆæ¯ä»æ•°æ®åº“ä¸­æ°¸ä¹…åˆ é™¤

---

### 4.12 è·å–å¯¹è¯è®°å½•
**æ¥å£**: `GET /api/messages/conversation/user-002`

**è¯·æ±‚å¤´**:
```json
X-User-Id: user-001
```

**é¢„æœŸç»“æœ**: è¿”å›user-001å’Œuser-002ä¹‹é—´çš„æ‰€æœ‰æ¶ˆæ¯

---

### 4.13 è·å–æ¶ˆæ¯çš„å›å¤
**æ¥å£**: `GET /api/messages/{messageId}/replies`

**é¢„æœŸç»“æœ**: è¿”å›è¯¥æ¶ˆæ¯çš„æ‰€æœ‰å›å¤

---

### 4.14 æŒ‰ç±»åˆ«è·å–æ¶ˆæ¯
**æ¥å£**: `GET /api/messages/category/urgent`

**è¯·æ±‚å¤´**:
```json
X-User-Id: user-001
```

**é¢„æœŸç»“æœ**: è¿”å›ç´§æ€¥ç±»åˆ«çš„æ¶ˆæ¯

---

## 5. æµ‹è¯•æµç¨‹å»ºè®®

### 5.1 æ’ç­ç®¡ç†å®Œæ•´æµç¨‹
1. åˆ›å»ºå‘˜å·¥ï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰
2. æ‰¹é‡åˆ›å»ºæ’ç­ â†’ éªŒè¯æ’ç­å†²çª
3. è·å–å‘¨æ’ç­æŸ¥çœ‹ç»“æœ
4. æ‰¹é‡æ›´æ–°æ’ç­çŠ¶æ€
5. å¤åˆ¶æ’ç­åˆ°ä¸‹ä¸€å¤©
6. åˆ é™¤æŒ‡å®šæ—¥æœŸæ’ç­

### 5.2 å‘˜å·¥ç…§ç‰‡ç®¡ç†å®Œæ•´æµç¨‹
1. è·å–æ²¡æœ‰ç…§ç‰‡çš„å‘˜å·¥åˆ—è¡¨
2. ä¸ºå•ä¸ªå‘˜å·¥ä¸Šä¼ ç…§ç‰‡
3. æ‰¹é‡ä¸Šä¼ å¤šä¸ªå‘˜å·¥ç…§ç‰‡
4. éªŒè¯ç…§ç‰‡å·²ä¸Šä¼ 
5. åˆ é™¤æŸä¸ªå‘˜å·¥çš„ç…§ç‰‡

### 5.3 é€šçŸ¥åŠŸèƒ½å®Œæ•´æµç¨‹
1. åˆ›å»ºä»»åŠ¡åˆ†é…é€šçŸ¥
2. è·å–æœªè¯»é€šçŸ¥æ•°é‡
3. è·å–æœªè¯»é€šçŸ¥åˆ—è¡¨
4. æ ‡è®°å•ä¸ªé€šçŸ¥ä¸ºå·²è¯»
5. åˆ›å»ºå…¶ä»–ç±»å‹é€šçŸ¥ï¼ˆæ’ç­æ›´æ–°ã€ä»»åŠ¡å®Œæˆç­‰ï¼‰
6. æŒ‰ç±»åˆ«æŸ¥è¯¢é€šçŸ¥
7. æ ‡è®°æ‰€æœ‰é€šçŸ¥ä¸ºå·²è¯»
8. åˆ é™¤é€šçŸ¥

### 5.4 é€šä¿¡åŠŸèƒ½å®Œæ•´æµç¨‹
1. ç”¨æˆ·Aå‘é€æ¶ˆæ¯ç»™ç”¨æˆ·B
2. ç”¨æˆ·Bè·å–æœªè¯»æ¶ˆæ¯æ•°é‡
3. ç”¨æˆ·BæŸ¥çœ‹æ”¶ä»¶ç®±
4. ç”¨æˆ·Bé˜…è¯»æ¶ˆæ¯ï¼ˆæ ‡è®°ä¸ºå·²è¯»ï¼‰
5. ç”¨æˆ·Bå›å¤æ¶ˆæ¯
6. ç”¨æˆ·Aè·å–å¯¹è¯è®°å½•
7. æŸ¥çœ‹æ¶ˆæ¯çš„æ‰€æœ‰å›å¤
8. å½’æ¡£æˆ–åˆ é™¤æ¶ˆæ¯

---

## 6. å¸¸è§æµ‹è¯•åœºæ™¯

### åœºæ™¯1: ç®¡ç†å‘˜åˆ›å»ºä¸€å‘¨æ’ç­
```
1. POST /api/schedules/batch-create (åˆ›å»ºå‘¨ä¸€æ’ç­)
2. POST /api/schedules/copy (å¤åˆ¶åˆ°å‘¨äºŒ)
3. POST /api/schedules/copy (å¤åˆ¶åˆ°å‘¨ä¸‰)
4. ... é‡å¤åˆ°å‘¨æ—¥
5. GET /api/schedules/weekly (æŸ¥çœ‹æ•´å‘¨æ’ç­)
```

### åœºæ™¯2: å·¥ä½œäººå‘˜æ”¶åˆ°ä»»åŠ¡å¹¶å®Œæˆ
```
1. Manager: åˆ›å»ºä»»åŠ¡ (è‡ªåŠ¨è§¦å‘ä»»åŠ¡åˆ†é…é€šçŸ¥)
2. Worker: GET /api/notifications/unread (æŸ¥çœ‹æœªè¯»é€šçŸ¥)
3. Worker: PUT /api/notifications/{id}/read (æ ‡è®°é€šçŸ¥ä¸ºå·²è¯»)
4. Worker: å®Œæˆä»»åŠ¡
5. Worker: POST /api/notifications/task-completed (é€šçŸ¥ç®¡ç†å‘˜)
6. Manager: æ”¶åˆ°ä»»åŠ¡å®Œæˆé€šçŸ¥
```

### åœºæ™¯3: ç”¨æˆ·ä¹‹é—´çš„æ¶ˆæ¯å¾€æ¥
```
1. User A: POST /api/messages (å‘é€æ¶ˆæ¯ç»™User B)
2. User B: GET /api/messages/unread/count (æŸ¥çœ‹æœªè¯»æ•°é‡)
3. User B: GET /api/messages/inbox (æŸ¥çœ‹æ”¶ä»¶ç®±)
4. User B: PUT /api/messages/{id}/read (æ ‡è®°ä¸ºå·²è¯»)
5. User B: POST /api/messages/{id}/reply (å›å¤æ¶ˆæ¯)
6. User A: GET /api/messages/conversation/{userB} (æŸ¥çœ‹å¯¹è¯)
```

---

## 7. æ³¨æ„äº‹é¡¹

1. **è¯·æ±‚å¤´**: å¤§éƒ¨åˆ†æ¥å£éœ€è¦ `X-User-Id` å’Œ/æˆ– `X-Organization-Id` è¯·æ±‚å¤´
2. **æ—¥æœŸæ ¼å¼**: ä½¿ç”¨ `yyyy-MM-dd` æ ¼å¼ (å¦‚: 2025-01-20)
3. **IDæ ¼å¼**: å‘˜å·¥IDä½¿ç”¨ `W001`, `W002` ç­‰æ ¼å¼
4. **é»˜è®¤å€¼**: å¦‚æœä¸æä¾›è¯·æ±‚å¤´ï¼Œç³»ç»Ÿä¼šä½¿ç”¨é»˜è®¤å€¼ï¼ˆå¦‚ org-001, default-user-001ï¼‰
5. **å…³è”åŠŸèƒ½**: å‘é€æ¶ˆæ¯æ—¶ä¼šè‡ªåŠ¨åˆ›å»ºé€šçŸ¥

---

## 8. å¿«é€Ÿæµ‹è¯•æ•°æ®

### å‘˜å·¥IDç¤ºä¾‹
```
W001, W002, W003, W004, W005
```

### ç”¨æˆ·IDç¤ºä¾‹
```
manager-001, user-001, user-002, worker-001
```

### ç»„ç»‡ID
```
org-001
```

### æ—¥æœŸç¤ºä¾‹
```
2025-01-20, 2025-01-21, 2025-01-22
```

---

ç¥æµ‹è¯•é¡ºåˆ©ï¼ğŸš€



